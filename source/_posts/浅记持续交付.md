---
title: 浅记持续交付
categories: 学习笔记
date: 2019-09-28 14:34:25
tags: CI/CD
keywords:[持续交付]
description:持续交付学习笔记
---

# 定义

持续交付是开发人员，如何将一个好的点子，以最快的速度交付给用户的方法。

持续集成：开发反复提交-构建-测试的过程；

持续部署：可交付的产品快速且安全地交给用户使用的一套方法和系统；

通过统一标准、规范流程、工具化、自动化等的方式，影响着整个研发周期。

人（组织文化）+事（流程）+物（架构）。

**DevOps是一种鼓励协作的研发文化，它的概念比持续交付更宽泛，持续交付是DevOps的一种工具和技术实现。**



# 实践

拿Java中常用的maven来举例：

maven的原则：

最短路径优先，如果A依赖C，A依赖B，B依赖C，那么maven会使用A依赖的C的版本；

第一声明优先，如果A依赖B和C，B和C都依赖了D，那么maven会使用B依赖的版本。

实践：

* 不要在生产环境使用SNAPSHOT版本的包；
* 在父模块使用`dependencyManagment`来统一版本；
* 对于一组依赖的控制，使用BOM来进行统一管理；
* 使用`properties`来减少重复劳动；
* 不要在生产环境中使用`mvn install`命令，因为这个命令会导致真正需要的包被覆盖；
* 禁止变更了代码不改版本号就上传到仓库。

集成分支上线后回滚，

```
git fetch origin  
$ git checkout master
$ git reset --hard  V0529         # 把本地的 master 分支的指针回退到 V0529，此时暂存区 (index) 里就指向 V0529 里的内容了。
$ git reset --soft  origin/master  # --soft 使得本地的 master 分支的指针重新回到 V05javascript:;30，而暂存区 (index) 变成 V0529 的内容。
$ git commit -m "rollback to V0529"  # 把暂存区里的内容提交，这样一来新生成的 commit 的内容和 V0529 相同。 
$ git push origin  master        # 远端的 master 也被回滚。

```

推动规范的完成：

* 代码以及依赖规范；
* 命名规范；
* 开发规范；
* 配置规范；
* 部署规范；
* 安全规范；
* 测试规范。

环境构建流水线：

可以通过OpenStack进行物理机和虚拟机的初始化工作，然后通过自动化的配置管理工具（Puppet、Chef、Ansible、SaltStack）安装一些基础软件，例如JDK和Tomcat等。如果采用资源池的方式，可以根据平时机器的使用情况预先分派一个资源池，省的从paas平台申请机器时还需要等待初始化。

> 云计算的三种模式：
>
> * SaaS：软件即服务，提供用户所需要的一切应用；
> * PaaS：平台即服务，提供了一个大的框架，包括中间件、操作系统、软件运行时环境等；
> * Iaas：基础架构即服务，只提供网络，存储，虚拟化技术等底层，其他需要用户自助。

应用部署流水线：

* 单应用部署流水化；
* 应用部署并行；
* 流水线的容错机制：错误中断或者优先完成正常的，最后将错误的交给用户解决。

## 容器技术

统一了软件环境和软件代码。

* 交付结果一致；
* 交付自动化；
* 交付个性化；
* 交付版本控制。

## 构建提速

### 私有仓库

* createrepo：搭建CentOS的yum仓库；
* Nexus：Java的maven仓库；
* cnpm：NodeJS的npm仓库；
* pypiserver：Python的pip仓库；
* gitlab：代码仓库；
* Harbor：Docker镜像仓库。

### Maven调优

* 合适堆内存；
* `-Dmaven.test.skip=true`跳过单元测试（`-DskipTests`命令还会编译测试文件）